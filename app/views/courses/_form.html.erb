<%= form_with(model: [@modality, @course], local: true, class: "max-w-2xl mx-auto mb-5") do |form| %>
  <% if @course.errors.any? %>
    <div class="bg-red-900/30 border border-red-500 text-red-300 px-4 py-3 rounded-lg mb-6">
      <h4 class="font-bold mb-2"><%= pluralize(@course.errors.count, "erro") %> impediram este curso de ser salvo:</h4>
      <ul class="list-disc list-inside space-y-1">
        <% @course.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <div class="space-y-6">
    <!-- Campo Nome -->
    <div>
      <%= form.label :name, class: 'block text-zinc-200 font-medium mb-2' %>
      <%= form.text_field :name, class: 'w-full bg-zinc-800/70 border border-zinc-600 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-zinc-400 transition duration-200' %>
    </div>

    <!-- Campo Descrição -->
    <div>
      <%= form.label :description, class: 'block text-zinc-200 font-medium mb-2' %>
      <%= form.text_area :description, rows: 5, class: 'w-full bg-zinc-800/70 border border-zinc-600 text-white rounded-lg px-4 py-3 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent placeholder-zinc-400 transition duration-200' %>
    </div>

    <!-- Campo Imagem - Estilizado -->
    <div>
      <%= form.label :image, class: 'block text-zinc-200 font-medium mb-2' %>
      <div class="flex items-center justify-center w-full">
        <label class="flex flex-col w-full h-32 border-2 border-dashed border-zinc-600 hover:border-zinc-500 rounded-lg cursor-pointer bg-zinc-800/50 hover:bg-zinc-800/70 transition duration-200">
          <div class="flex flex-col items-center justify-center pt-7">
            <% if @course.image.attached? %>
              <%= image_tag @course.image, class: "h-16 w-16 object-cover rounded-md mb-2" %>
              <p class="text-sm text-zinc-300">Clique para alterar a imagem</p>
            <% else %>
              <svg class="w-10 h-10 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
              </svg>
              <p class="pt-1 text-sm text-zinc-300">Arraste ou clique para selecionar uma imagem</p>
            <% end %>
          </div>
          <%= form.file_field :image, class: "opacity-0 absolute", id: "course-image-input" %>
        </label>
      </div>
      <p class="mt-1 text-xs text-zinc-400">Formatos suportados: JPG, PNG (Máx. 2MB)</p>
    </div>

    <!-- Botões -->
    <div class="flex justify-end gap-3 pt-2">
      <%= link_to 'Cancelar', :back, class: 'px-5 py-2.5 rounded-lg font-medium text-zinc-300 hover:text-white bg-zinc-700 hover:bg-zinc-600 transition duration-200' %>
      <%= form.submit 'Salvar Curso', class: 'px-5 py-2.5 rounded-lg font-medium text-white bg-blue-600 hover:bg-blue-700 focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 focus:ring-offset-zinc-900 transition duration-200' %>
    </div>
  </div>
<% end %>

<!-- Script para mostrar preview da imagem selecionada -->
<script>
  document.getElementById('course-image-input').addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const preview = document.createElement('img');
        preview.src = e.target.result;
        preview.className = 'h-16 w-16 object-cover rounded-md mb-2';
        
        const container = document.querySelector('label[for="course-image-input"] div');
        container.innerHTML = '';
        container.appendChild(preview);
        container.insertAdjacentHTML('beforeend', '<p class="text-sm text-zinc-300">Clique para alterar a imagem</p>');
      }
      reader.readAsDataURL(file);
    }
  });
</script>